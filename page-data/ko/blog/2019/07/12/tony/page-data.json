{"componentChunkName":"component---src-templates-post-tsx","path":"/ko/blog/2019/07/12/tony/","result":{"data":{"site":{"siteMetadata":{"title":"클래스101 기술 블로그","author":"class101","siteUrl":"https://class101.dev"}},"markdownRemark":{"id":"95a97212-505f-5f16-8f1d-b75c9da1cbc3","tableOfContents":"<ul>\n<li>\n<p><a href=\"/blog/2019/07/12/tony/#jump-to-monorepo\">Jump to Monorepo</a></p>\n<ul>\n<li><a href=\"/blog/2019/07/12/tony/#overview\">Overview</a></li>\n<li><a href=\"/blog/2019/07/12/tony/#%EB%AA%A8%EB%85%B8%EB%A0%88%ED%8F%AC%EC%9D%98-%EC%9D%B4%ED%95%B4\">모노레포의 이해</a></li>\n<li>\n<p><a href=\"/blog/2019/07/12/tony/#%EB%AA%A8%EB%85%B8%EB%A0%88%ED%8F%AC%EC%9D%98-%ED%8A%B9%EC%A7%95\">모노레포의 특징</a></p>\n<ul>\n<li><a href=\"/blog/2019/07/12/tony/#%EC%BD%94%EB%93%9C%EC%9D%98-%EC%9E%AC%EC%82%AC%EC%9A%A9\">코드의 재사용</a></li>\n<li><a href=\"/blog/2019/07/12/tony/#%EC%9D%98%EC%A1%B4%EC%84%B1-%EA%B4%80%EB%A6%AC\">의존성 관리</a></li>\n<li><a href=\"/blog/2019/07/12/tony/#%EC%9E%91%EC%9D%80-%EC%BB%A4%EB%B0%8B%EA%B3%BC-pr\">작은 커밋과 PR</a></li>\n<li><a href=\"/blog/2019/07/12/tony/#%EB%8C%80%EA%B7%9C%EB%AA%A8-%EB%A6%AC%ED%8C%A9%ED%86%A0%EB%A7%81\">대규모 리팩토링</a></li>\n<li><a href=\"/blog/2019/07/12/tony/#%ED%8C%80-%EA%B0%84-%ED%98%91%EC%97%85\">팀 간 협업</a></li>\n<li><a href=\"/blog/2019/07/12/tony/#trunk-based-development\">Trunk Based Development</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/blog/2019/07/12/tony/#%EB%AA%A8%EB%85%B8%EB%A0%88%ED%8F%AC%EC%9D%98-%ED%95%84%EC%9A%94%EC%84%B1\">모노레포의 필요성</a></p>\n<ul>\n<li><a href=\"/blog/2019/07/12/tony/#schema-synchronization%EB%A5%BC-%ED%86%B5%ED%95%9C-%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4-%EB%B3%80%ED%99%98\">Schema Synchronization를 통한 인터페이스 변환</a></li>\n<li><a href=\"/blog/2019/07/12/tony/#%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%8B%A4%ED%96%89\">테스트 실행</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/blog/2019/07/12/tony/#code-base-%EC%A1%B0%ED%95%A9ab\">Code Base 조합(a)(b)</a></p>\n<ul>\n<li><a href=\"/blog/2019/07/12/tony/#%EA%B0%9C%EB%B0%9C-%EC%BB%A4%EB%AE%A4%EB%8B%88%EC%BC%80%EC%9D%B4%EC%85%98%EC%9D%84-%EC%9C%84%ED%95%9C-git-history%EC%9D%98-%EB%B3%B4%EC%A1%B4\">개발 커뮤니케이션을 위한 Git history의 보존</a></li>\n<li><a href=\"/blog/2019/07/12/tony/#lerna%EC%9D%98-%EC%82%AC%EC%9A%A9%EA%B3%BC-%EB%AC%B8%EC%A0%9C%EC%A0%90\">lerna의 사용과 문제점</a></li>\n<li><a href=\"/blog/2019/07/12/tony/#git-log-git-am%EC%9D%84-%ED%86%B5%ED%95%9C-codebase-%EC%A1%B0%ED%95%A9\">git log, git am을 통한 CodeBase 조합</a></li>\n</ul>\n</li>\n<li><a href=\"/blog/2019/07/12/tony/#%EA%B2%B0%EB%A1%A0\">결론</a></li>\n<li><a href=\"/blog/2019/07/12/tony/#%EC%B0%B8%EA%B3%A0\">참고</a></li>\n<li><a href=\"/blog/2019/07/12/tony/#%EC%B0%B8%EA%B3%A0%EB%AC%B8%ED%97%8C\">참고문헌</a></li>\n</ul>\n</li>\n</ul>","excerpt":"Jump to Monorepo 편집자 주\n‘Monorepo’는 독자의 가독성을 높이기 위해 글의 제목을 제외한 본문 전체에서 ‘모노레포’로 한글 표기함. 이는 외래어 표기법 상 관용에 해당함. Overview 이번 글에서는 모노레포를 도입한 계기와 장・단점, Git history를 보존한 채 레포지토리를 합치는 방법을 다루겠습니다. 모노레포의 이해 모노레포는 두 개 이상의 프로젝트 코드를 하나의 레포지토리에서 관리하는 기법입니다.1 페이스북이나 구글, 마이크로소프트 등 대형 소프트웨어 기업에서도 사용되고 있고, 일부 인기 있는 오…","html":"<h1>Jump to Monorepo</h1>\n<p><strong>편집자 주</strong>\n‘Monorepo’는 독자의 가독성을 높이기 위해 글의 제목을 제외한 본문 전체에서 ‘모노레포’로 한글 표기함. 이는 외래어 표기법 상 관용에 해당함.</p>\n<h2>Overview</h2>\n<p>이번 글에서는 모노레포를 도입한 계기와 장・단점, Git history를 보존한 채 레포지토리를 합치는 방법을 다루겠습니다.</p>\n<h2>모노레포의 이해</h2>\n<p>모노레포는 두 개 이상의 프로젝트 코드를 하나의 레포지토리에서 관리하는 기법입니다.[1] 페이스북이나 구글, 마이크로소프트 등 대형 소프트웨어 기업에서도 사용되고 있고, 일부 인기 있는 오픈 소스 프로젝트들도 그들의 레포지토리를 관리하기 위해 Monorepo를 쓰고 있습니다. 그렇다면 클래스101에서는 왜 모노레포가 필요할까요? 우선 그 특징부터 살펴보겠습니다.</p>\n<h2>모노레포의 특징</h2>\n<h3>코드의 재사용</h3>\n<p>여러 레포지토리에서 프로젝트를 진행하면 비슷한 로직을 각 레포지토리에서 중복 구현하는 때가 많습니다. 공통 로직을 다시 작성하지 않고 공유하려면 레포지토리를 추가하고 이에 해당하는 의존성을 추가해주어야 합니다. 다른 레포의 의존성을 추가하는 것은 같은 레포에서 패키지의 의존성을 추가하는 것보다 많은 비용이 듭니다. 만약 멀티레포에서는 적절한 버전을 찾아 <code class=\"language-text\">package.json</code> 에 추가해주고 <code class=\"language-text\">npm install</code> 과 같은 커맨드를 매번 실행해주어야 합니다. 반면 lerna(JavaScript 모노레포 관리 툴)를 사용한다면 <code class=\"language-text\">lerna boostrap</code> 이라는 하나의 커맨드로 모든 의존성을 추가하고 해당 상태에서 드 수정을 할 수 있습니다.</p>\n<h3>의존성 관리</h3>\n<p>클래스101에서는 Code Formatting을 위해 prettier, Code Linting을 위한 tslint를 사용합니다. 기존의 멀티레포 구조에서는 각 레포에 prettier, tslint를 각각 설치해야 했습니다. 하지만 모노레포와 함께라면 각 레포를 Cloning하고 일일이 업데이트하는 과정을 거치지 않아도 됩니다.</p>\n<h3>작은 커밋과 PR</h3>\n<p>여러 레포에서 변경사항이 있다면 개발자는 작은 커밋으로 나눠 PR(Pull Request)을 보내는 것보다, 모든 코드를 작성하고 이에 대한 의존성을 바꾸는 방식의 작업을 선호합니다. 하지만 모노레포에서는 여러 패키지의 변경사항을 하나의 커밋과 PR로 제출할 수 있습니다. 덕분에 더 작게 나눠서 작업할 수 있죠. 다만 하나의 커밋에는 한 패키지의 변경사항만 기록하는 SRP(Single Responsibility Principle, 단일 책임 원칙)를 지켜야 합니다.</p>\n<h3>대규모 리팩토링</h3>\n<p>모노레포로 레포지터리를 운영해보니 하나의 파일에 대한 컨트리뷰터가 상당히 많아졌습니다. 다행히 해당 로직을 이해하는 동료가 많아 여러 사람이 효율적으로 로직을 작성하는 방식에 대해서도 함께 생각할 수 있었죠. 이와 같은 멘탈 모델 얼라인으로 대규모 리팩토링을 유도할 수 있었습니다.</p>\n<h3>팀 간 협업</h3>\n<p>모든 구성원이 모든 코드에 접근할 수 있기 때문에 팀 간 협업이 자유롭습니다.</p>\n<h3>Trunk Based Development</h3>\n<p>모노레포에서는 서버와 웹을 합쳐 하나의 버전으로 판단할 수 있습니다. 이것은 Master 브랜치를 항상 배포할 수 있도록 유지하는 Trunk Basement Development를 진행하는 데에 도움이 됩니다.</p>\n<h2>모노레포의 필요성</h2>\n<h3>Schema Synchronization를 통한 인터페이스 변환</h3>\n<p>클래스101에서는 모든 코드를 TypeScript로 작성하고 있습니다. 또한 Apollo Server와 type-graphql을 이용하여 GraphQL기반 API도 작성하고 있어 GraphQL 스키마를 TypeScript 인터페이스로 변환하는 과정이 꼭 필요합니다. 우리는 이것을 Class101에서는 <code class=\"language-text\">Schema Sync</code> 라고 부릅니다. 기존에는 스테이징 서버에서 제공하주는 <code class=\"language-text\">schema.gql</code> 파일을 이용하여 <code class=\"language-text\">Schema Sync</code> 를 진행했었습니다. 하지만 스테이징 서버가 업데이트되기 전에 Schema를 변경하거나 이를 사용하는 웹과 앱에서 Fragment를 변경하면 위험할 수도 있었죠. 모노레포에서는 서버 코드를 변경할 때 코드를 기반으로 <code class=\"language-text\">Schema Sync</code> 를 실행할 수 있어 이러한 위험요소를 제거할 수 있었습니다.</p>\n<h3>테스트 실행</h3>\n<p>Cypress, Pupeeter등을 이용하여 E2E 테스트를 실행한다고 가정해봅시다. 배포가능함을 보장하기 위해선 서버가 변경됐을 때도, 웹이 변경됐을 때도 E2E 테스트를 실행해야 합니다. 멀티레포에서는 하나의 Testing레포를 만들거나 각각의 레포에 E2E테스트를 중복구현해야 합니다. 그러나 모노레포에서는 테스트를 위한 package하나만 추가해주면 모든 변경사항에 대해 지속적으로 테스트할 수 있습니다.</p>\n<p>모노레포를 도입하는 것은 빠르면 빠를수록 좋습니다. 코드가 늘어나고, 의존성이 늘어날 수록 고려해야 할 사항이 많이지기 때문이죠. 클래스101에서도 더 늦기 전에 모노레포를 도입하기로 했습니다. 가장 먼저 진행한 작업은 Code Base 조합이었습니다.</p>\n<h2>Code Base 조합(a)(b)</h2>\n<h3>개발 커뮤니케이션을 위한 Git history의 보존</h3>\n<p>개발자가 새로운 기능을 개발하다가 기존의 기능을 함께 이용하면 가장 많이 듣는 질문은 바로 “이거 왜 이렇게 개발했어?”입니다. 흔히 Blame이라고도 합니다. 이런 Blame에 대한 기록이 모두 사라지면 나중에 커뮤니케이션 효율이 떨어질 수밖에 없습니다. 이와 같은 부작용을 겪지 않기 위해 Git history를 모두 보존해야 했습니다. 먼저 lerna를 써봤습니다.</p>\n<h3>lerna의 사용과 문제점</h3>\n<p>lerna에는 <code class=\"language-text\">import</code>라는 커맨드가 존재합니다. 아래와 같은 폴더 구조를 가진 프로젝트를 가정해봅시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">package-1/\n    package.json\nmy-lerna-repo/\n    package.json\n    packages/\n    package-2/\n        package.json</code></pre></div>\n<p>만약 package-1을 my-lerna-repo/에 추가하고 싶다면 <code class=\"language-text\">import</code>커맨드를 사용하면 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># cd my-lerna-repo</span>\nlerna <span class=\"token function\">import</span> <span class=\"token punctuation\">..</span>/package-1</code></pre></div>\n<p>아래와 같은 에러가 나타난다면 flatten 옵션을 주어 실행하면 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># &lt;https://stackoverflow.com/questions/52119818/trouble-importing-project-in-lerna></span>\n<span class=\"token comment\"># 해당 에러를 기록해 두지 않아 에러 로그는 스택오버플로우에서 가져왔습니다.</span>\nlerna ERR<span class=\"token operator\">!</span> <span class=\"token function\">import</span> Rolling back to previous HEAD <span class=\"token punctuation\">(</span>commit a235ee9b3c382c9751abf792a22b2ec9df894a18<span class=\"token punctuation\">)</span>\nlerna ERR<span class=\"token operator\">!</span> EIMPORT Failed to apply commit a932c8cf8.\nlerna ERR<span class=\"token operator\">!</span> EIMPORT Command failed: <span class=\"token function\">git</span> am -3 --keep-non-patch\nlerna ERR<span class=\"token operator\">!</span> EIMPORT error: Failed to merge <span class=\"token keyword\">in</span> the changes.\nlerna ERR<span class=\"token operator\">!</span> EIMPORT Applying: Made Device Analytics Controller. Made device-analytics.stache be rendered through controller.\nlerna ERR<span class=\"token operator\">!</span> EIMPORT Using index info to reconstruct a base tree<span class=\"token punctuation\">..</span>.\nlerna ERR<span class=\"token operator\">!</span> EIMPORT M    packages/some-repo/app/scripts/app/controls/active-device.js\nlerna ERR<span class=\"token operator\">!</span> EIMPORT M    packages/some-repo/app/templates/device/active-device.stache\nlerna ERR<span class=\"token operator\">!</span> EIMPORT M    packages/some-repo/views/index.jade\nlerna ERR<span class=\"token operator\">!</span> EIMPORT Falling back to patching base and <span class=\"token number\">3</span>-way merge<span class=\"token punctuation\">..</span>.\nlerna ERR<span class=\"token operator\">!</span> EIMPORT Auto-merging packages/some-repo/app/templates/device/device-analytics.stache\nlerna ERR<span class=\"token operator\">!</span> EIMPORT CONFLICT <span class=\"token punctuation\">(</span>add/add<span class=\"token punctuation\">)</span>: Merge conflict <span class=\"token keyword\">in</span> packages/some-repo/app/templates/device/device-analytics.stache\nlerna ERR<span class=\"token operator\">!</span> EIMPORT Auto-merging packages/some-repo/app/scripts/app/controls/device-analytics.js\nlerna ERR<span class=\"token operator\">!</span> EIMPORT CONFLICT <span class=\"token punctuation\">(</span>add/add<span class=\"token punctuation\">)</span>: Merge conflict <span class=\"token keyword\">in</span> packages/some-repo/app/scripts/app/controls/device-analytics.js\nlerna ERR<span class=\"token operator\">!</span> EIMPORT Auto-merging packages/some-repo/app/scripts/app/controls/active-device.js\nlerna ERR<span class=\"token operator\">!</span> EIMPORT CONFLICT <span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">)</span>: Merge conflict <span class=\"token keyword\">in</span> packages/some-repo/app/scripts/app/controls/active-device.js\nlerna ERR<span class=\"token operator\">!</span> EIMPORT Patch failed at 0001 Made Device Analytics Controller. Made device-analytics.stache be rendered through controller.\nlerna ERR<span class=\"token operator\">!</span> EIMPORT The copy of the patch that failed is found in: .git/rebase-apply/patch\nlerna ERR<span class=\"token operator\">!</span> EIMPORT When you have resolved this problem, run <span class=\"token string\">\"git am --continue\"</span><span class=\"token builtin class-name\">.</span>\nlerna ERR<span class=\"token operator\">!</span> EIMPORT If you prefer to skip this patch, run <span class=\"token string\">\"git am --skip\"</span> instead.\nlerna ERR<span class=\"token operator\">!</span> EIMPORT To restore the original branch and stop patching, run <span class=\"token string\">\"git am --abort\"</span><span class=\"token builtin class-name\">.</span>\nlerna ERR<span class=\"token operator\">!</span> EIMPORT\nlerna ERR<span class=\"token operator\">!</span> EIMPORT\nlerna ERR<span class=\"token operator\">!</span> EIMPORT You may try again with --flatten to <span class=\"token function\">import</span> flat history.</code></pre></div>\n<p>실제로 <code class=\"language-text\">lerna import</code>커맨드를 사용하게 되면 모든 것이 해결되진 않습니다. flatten 옵션을 줘도 마찬가지죠. 이는 프로젝트 초기에 Merge, Rebase, Force Push 등을 하며 올바르지 않은 변경사항이 강제로 합쳐진 경우가 있기 때문입니다. 이 경우엔 아래와 같은 에러를 마주할 것입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># &lt;https://stackoverflow.com/questions/52119818/trouble-importing-project-in-lerna></span>\nlerna ERR<span class=\"token operator\">!</span> EIMPORT Failed to apply commit f16ede066.\nlerna ERR<span class=\"token operator\">!</span> EIMPORT Command failed: <span class=\"token function\">git</span> am -3 --keep-non-patch\nlerna ERR<span class=\"token operator\">!</span> EIMPORT error: <span class=\"token function\">git</span> <span class=\"token function\">diff</span> header lacks filename information when removing <span class=\"token number\">1</span> leading pathname component <span class=\"token punctuation\">(</span>line <span class=\"token number\">845968</span><span class=\"token punctuation\">)</span>\nlerna ERR<span class=\"token operator\">!</span> EIMPORT error: could not build fake ancestor\nlerna ERR<span class=\"token operator\">!</span> EIMPORT Applying: Adding dist files. Refs <span class=\"token comment\">#17</span>\nlerna ERR<span class=\"token operator\">!</span> EIMPORT Patch failed at 0001 Adding dist files. Refs <span class=\"token comment\">#17</span>\nlerna ERR<span class=\"token operator\">!</span> EIMPORT The copy of the patch that failed is found in: .git/rebase-apply/patch\nlerna ERR<span class=\"token operator\">!</span> EIMPORT When you have resolved this problem, run <span class=\"token string\">\"git am --continue\"</span><span class=\"token builtin class-name\">.</span>\nlerna ERR<span class=\"token operator\">!</span> EIMPORT If you prefer to skip this patch, run <span class=\"token string\">\"git am --skip\"</span> instead.\nlerna ERR<span class=\"token operator\">!</span> EIMPORT To restore the original branch and stop patching, run <span class=\"token string\">\"git am --abort\"</span><span class=\"token builtin class-name\">.</span></code></pre></div>\n<h3>git log, git am을 통한 CodeBase 조합</h3>\n<p>위와 같은 단점을 해결하기 위해 다른 해결책을 모색해야 했습니다. 클래스101의 테크리드, 조이의 도움으로 <code class=\"language-text\">git log</code>와 <code class=\"language-text\">git am</code>을 이용한다면 문제를 해결할 수 있다는 것을 알게 되었습니다. <code class=\"language-text\">git am</code>은 대화식으로 patch apply 과정을 진행할 수 있기 때문이죠.</p>\n<p><strong>git log</strong><br>\nterminal에서 <code class=\"language-text\">man git-log</code> 를 이용하면 매우 다양한 옵션이 있다는 걸 알 수 있습니다. 그중에서도 <code class=\"language-text\">-p</code> 옵션을 사용하면 아래 그림과 같은 patch파일을 만들 수 있었습니다.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8fe36c17b8fe92eb151aa7324efa4800/39c09/stackoverflow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 65.06410256410257%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACY0lEQVQ4y22TbVPaUBCFQ1tBXhyBoqIgqBUVBAR5CQlJCElIiIAIUuvY2un//xOnJwlWZuqHZ87m3t2ze5Mb4WzyAx4n7ncE8ROuFq8o3b+gvPxNXnG9+oNo10JCchBum9hmHOvZxEGcazES6Y4Q7lgQ8qMFiuMVsuYDjp0VcvYSRfcJudESWWuBPNf8wjVR0abhiEZjxGXXN9tRJojyecszjHd0bDdVRBoKwiTW0vD5RoFwLWOroSLc1Hx9iyO3A58tEvZo6VTd10hbh3CkGOhMXTTcMeSHia8V28G5MUKVekE9kA2kxSGSXR2pHlU0sNszkJJMpGSLjJCkJiVOmGjKyPd1ZEQNBc3AEeNDNsmpFnKahaxiYr9vIMrJvamFah9CTQm0Sq2pEOrcuxkEFHQbe30Ted3BiemiMlngmGsZScceJzvgXpbmXs7hRpPdLourMkI1Gtdp2uBzk0e+Gt1BnMyx/PUTLWp7/oBLy4ZQFlkg+UXBVOvJ6sqG9oP964287MDA1WyK87GLU9dB0hwiphOF3So0LXcD/UePBr13k1r/3dijcOcgNxsjM7ZRmLnIOnZQ4BWW14Yfsm7g5W6eIm7xwpKoNkTohht1CZ+IlxiqSQjVA/wGPhvTvpm/Te6RMCzsjh3sr2Y4fJ5Tp8gs7sgEMX71hG4iztfiHTH0H2xa8RAZi74KAi+zwIu8w/uXXk6RoHn6cYovHU5bakI4X3NxS1oQLj/gosNcTlqitl+ecTYzcTI1+QsOUXQGOJvz2gwfkVYf8VVb+qTUJQ6UOYryPQqkuMaLvw2HKFkq0fAX2ZKMrwYm6TcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"[그림 1] 출처: StackOverflow\"\n        title=\"\"\n        src=\"/static/8fe36c17b8fe92eb151aa7324efa4800/fcda8/stackoverflow.png\"\n        srcset=\"/static/8fe36c17b8fe92eb151aa7324efa4800/12f09/stackoverflow.png 148w,\n/static/8fe36c17b8fe92eb151aa7324efa4800/e4a3f/stackoverflow.png 295w,\n/static/8fe36c17b8fe92eb151aa7324efa4800/fcda8/stackoverflow.png 590w,\n/static/8fe36c17b8fe92eb151aa7324efa4800/39c09/stackoverflow.png 624w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p><strong>git am</strong><br>\n<code class=\"language-text\">git log</code> 를 통해 만들어진 패치파일을 <code class=\"language-text\">git am</code> 을 이용해 모노레포 폴더에서 적용할 수 있었습니다. 역시나 다양한 옵션을 사용하였고 실제 사용한 커맨드는 아래와 같습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># in web folder</span>\n<span class=\"token function\">git</span> log --reverse --first-parent -p -m --pretty<span class=\"token operator\">=</span>email --stat --binary HEAD <span class=\"token operator\">></span> class101-web.patch\n\n<span class=\"token comment\"># in mono folder</span>\n<span class=\"token function\">git</span> am --directory packages/web <span class=\"token punctuation\">..</span>/class101-web/class101-web.patch -3 --keep-non-patch --ignore-whitespace</code></pre></div>\n<ul>\n<li>\n<p><code class=\"language-text\">git log</code></p>\n<ul>\n<li>—reverse: git log 실행시 최근 커밋이 아닌 최초 커밋부터 기록을 확인하기 위해 사용한 옵션입니다.</li>\n<li>—first-parent: merge commit에 대해 첫번째 부모 커밋만 보여주는 옵션입니다.</li>\n<li>-p: patch를 만듭니다</li>\n<li>-m: Diff Formatting 옵션입니다. merge commit들의 diff를 full로 보여줍니다.</li>\n<li>—pretty: 커밋 로그를 주어진 param값에 맞추어 보여줍니다. oneline, short, medium, full, fuller, email, raw, format:$string and tformat:$string 중 하나의 값이 올 수 있습니다.</li>\n<li>—stat: diffstat을 만듭니다.</li>\n<li>—binary: output a binary diff that can be applied with git-apply</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">git am</code></p>\n<ul>\n<li>—directory: filename에 주어진 prefix를 붙입니다. (directory 위치 변경)</li>\n<li>-3: patch가 깨끗하게 적용이 되지 않았을 때, 3-way merge를 통해 재 적용합니다.</li>\n<li>—keep-non-patch: git의 mail info에 대해 -b 옵션을 전달합니다. 이는 PATCH를 포함한 bracket 짝이 있을 때에만 stripping합니다.</li>\n<li>—ignore-whitespace: ignore changes in whitespace in context lines if necessary</li>\n<li>참고 이미지\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2b222aec948a508a16693117a1783e81/08485/github-diff.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 31.678252234359483%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAAA5UlEQVQY04WQT0vDQBDF8/2/g3jyUjyoBy+iZz+BYMVCq9aGUptsdmc32T8/s8GU0AqdZZgZmPf2vSm89xhjsNYRQkDE0nUdYgRVq34WUkonGWM89D552tgNtRBrqZWiHsCWRmtc29KIYm8qUjwly5GFrD6+2O32PH0/c/V+y83ygSL/lDOrG/sMCjEQUhjAI8lYnXOsNxt076JpNJVWmFaw3lFwJqZkU3XbcofRvaPaII097Bf/3efY3vEsTnhZzXn7XLCuSn7s32n6d1bhVOlIWJotF/MZs8U9l6/X3C0f+wUGwl+HK9LL4ACuoQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"[그림 2] 출처: The GitHub Blog\"\n        title=\"\"\n        src=\"/static/2b222aec948a508a16693117a1783e81/fcda8/github-diff.png\"\n        srcset=\"/static/2b222aec948a508a16693117a1783e81/12f09/github-diff.png 148w,\n/static/2b222aec948a508a16693117a1783e81/e4a3f/github-diff.png 295w,\n/static/2b222aec948a508a16693117a1783e81/fcda8/github-diff.png 590w,\n/static/2b222aec948a508a16693117a1783e81/efc66/github-diff.png 885w,\n/static/2b222aec948a508a16693117a1783e81/c83ae/github-diff.png 1180w,\n/static/2b222aec948a508a16693117a1783e81/08485/github-diff.png 2014w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </li>\n</ul>\n</li>\n</ul>\n<h2>결론</h2>\n<p>지금까지 Monorepo의 특징을 살펴보고 lerna, git log, git am을 통해 Code Base까지 조합했습니다. 결과는 두 가지로 정리할 수 있습니다.</p>\n<ol>\n<li><code class=\"language-text\">lerna import</code>를 할 수 있는 패키지는 <code class=\"language-text\">lerna import</code>를 사용한다.</li>\n<li><code class=\"language-text\">lerna import</code>를 할 수 없는 패키지는 <code class=\"language-text\">git log</code>를 이용하여 패치 파일을 만들고 <code class=\"language-text\">git am</code>을 이용하여 해당 패치 파일을 적용한다.</li>\n</ol>\n<p>위와 같이 진행하니 약 3,800개의 커밋이 누락되었습니다. merge commit이 제외된 것도 포함한 수치입니다. 하지만 마지막 상태가 같고 최근 커밋은 모두 보존되어 레포지토리를 합치는 데에는 문제가 없었습니다. 개발 업무에 모노레포 도입이 필요하신가요? 아니면 깔끔하게 Git history를 보존하고 싶으신가요? 어떤 경우든 이번 글이 분명 업무 환경 개선에 도움이 될 겁니다.</p>\n<h2>참고</h2>\n<p>(a) 이 글에서는 javascript만 사용하는 프로젝트를 다루므로 Multi Language Monorepo 관리 자료는 아래 URL에서 참고할 수 있다. <a href=\"https://github.com/korfuri/awesome-monorepo\" target=\"_blank\" rel=\"nofollow\">https:// github.com/korfuri/awesome-monorepo</a></p>\n<p>(b) ‘조합(組合)‘은 ‘여럿을 한데 모아 한 덩어리로 짬.‘을 뜻하고, ‘결합(結合)‘은 ‘둘 이상의 사물이나 사람이 서로 관계를 맺어 하나가 됨.‘을 뜻한다. 본문에서는 두 목록을 합쳐 하나의 새로운 목록을 구성하였으므로 그 문맥상 ‘조합’으로 표기한다.</p>\n<h2>참고문헌</h2>\n<p><strong>논문 및 학술자료</strong></p>\n<ol>\n<li>Gleison Brito ・ Ricardo Terra ・ Marco Tulio Valente, &#x3C;Monorepos: A Multivocal Literature Review>, 6th Brazilian Workshop on Software Visualization, Evolution and Maintenance (VEM), 2018. p.1.</li>\n</ol>\n<p><strong>웹사이트</strong></p>\n<ul>\n<li>Monorepo Advantages, Wikipedia, <a href=\"https://en.wikipedia.org/wiki/Monorepo#Advantages\" target=\"_blank\" rel=\"nofollow\">https:// en.wikipedia.org/wiki/Monorepo#Advantages</a> 참조. (2019.07.12)</li>\n<li>Trouble importing project in lerna, stack overflow, <a href=\"https://stackoverflow.com/questions/52119818/trouble-importing-project-in-lerna\" target=\"_blank\" rel=\"nofollow\">https:// stackoverflow.com/questions/52119818/trouble-importing-project-in-lerna</a> 참조. (2019.07.12)</li>\n<li>View Git Patch Files In Color With This Script, malloc.co, <a href=\"http://www.malloc.co/git/view-git-patch-files-in-color-with-this-script/\" target=\"_blank\" rel=\"nofollow\">http:// www.malloc.co/git/view-git-patch-files-in-color-with-this-script/</a> 참조. (2019.07.12)</li>\n<li>Ignore white space in code review, The GitHub Blog, <a href=\"https://github.blog/2018-05-01-ignore-white-space-in-code-review/\" target=\"_blank\" rel=\"nofollow\">https:// github.blog/2018-05-01-ignore-white-space-in-code-review/</a> 참조. (2019.07.12)</li>\n</ul>","fields":{"slug":"blog/2019/07/12/tony","language":"ko"},"frontmatter":{"title":"Monorepo with typescript (1)","thumbnail":"/images/thumbnails/monorepo.png","date":"2019-07-12","description":"","author":{"id":"tony","profileImage":"/images/profiles/tony.png","description":"가리지 않고 배우는 개발자 한건호입니다.","github":"https://github.com/hrg921","blog":"https://blog.geonho.com/","linkedin":"https://www.linkedin.com/in/%EA%B1%B4%ED%98%B8-%ED%95%9C-76a139b1/"},"tags":["typescript","monorepo","lerna","git"]}}},"pageContext":{"slug":"blog/2019/07/12/tony","language":"ko","previous":null,"next":{"fields":{"slug":"blog/2019/07/16/lama","authorId":"lama","language":"ko"},"frontmatter":{"title":"Python 서버 개발자 관점에서 본 TypeScript, JavaScript","thumbnail":"/images/thumbnails/typescript.png","author":{"id":"lama","profileImage":"/images/profiles/lama.jpg","description":"넓은 경험을 가지고 싶은 개발자입니다.","github":"","blog":"","linkedin":""},"tags":["typescript","javascript"],"description":"","date":"2019-07-16T14:12:03.284Z"}}}}}